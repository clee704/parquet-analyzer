<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>{{ filename }} | Parquet Analyzer</title>
    <style>
        :root {
            --main-bg: #f9f9f9;
            --section-bg: #fff;
            --border-color: #eee;
            --code-bg: #e0e0e0c0;
            --column-bg: #f0f0f0;
            --text-color: #333;
            --muted-text-color: #999;
            --font-family: sans-serif;

            --segment-color: #f8ffd0e0;
            --segment-border-color: #e3ebb6e0;
            --segment-color-magic: #f19ff8e0;
            --segment-color-value: #f4f4f4e0;
            --segment-color-column-chunk-pages: #a6d4ffe0;
            --segment-color-page: #d8caffe0;
            --segment-color-group: #d7ffcde0;
        }

        body {
            margin: 1rem;
            font-family: var(--font-family);
            color: var(--text-color);
            background-color: var(--main-bg);
        }

        code {
            background-color: var(--code-bg);
            border-radius: 0.25rem;
            padding: 0.15rem 0.3rem;
            font-family: monospace;
            font-size: 0.8rem;
        }

        textarea {
            background-color: var(--code-bg);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 0.6rem 0;
            overflow-x: auto;
            width: 100%;
            height: 30rem;
            font-family: monospace;
            font-size: 0.8rem;
            box-sizing: border-box;
        }

        .title {
            margin-bottom: 1rem;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .column-name {
            background: transparent;
            border: 0;
            padding: 0;
            font-size: 0.9rem;
        }

        .section {
            margin: 1rem 0;
            padding: 0;
            background-color: var(--section-bg);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
        }

        .section__header {
            margin: 0;
            padding: 0.75rem 1rem;
            font-size: 1.2rem;
            font-weight: 500;
            border-bottom: 1px solid var(--border-color);
        }

        .section__title {
            margin: 0;
            display: inline-block;
            font-size: 1.2rem;
            font-weight: 500;
        }

        .section__content {
            padding: 0 1rem;
        }

        .section__content.is-open {
            padding: 0.75rem 1rem;
        }

        .summary {
            margin: 0;
            padding: 0;
            list-style: none;
        }

        .summary__item {
            padding: 0.6rem 0;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            column-gap: 0.25rem;
            row-gap: 0.6rem;
            border-bottom: 1px solid var(--border-color);
        }

        .summary__value {
            overflow-wrap: break-word;
            word-break: break-word;
        }

        .summary__item:first-child {
            padding-top: 0;
        }

        .summary__item:last-child {
            padding-bottom: 0;
            border-bottom: none;
        }

        .schema {
            margin-top: 0.6rem;
            padding: 0;
            list-style: none;
        }

        .schema .schema {
            padding-left: 1rem;
            border-left: 1px solid var(--border-color);
        }

        .schema__item {
            margin: 1rem 0;
        }

        .schema__prop--num-children {
            font-size: 0.8rem;
            color: var(--muted-text-color);
        }

        .key-value-metadata {
            margin-top: 0.6rem;
            width: 100%;
            border-collapse: collapse;
        }

        .key-value-metadata th {
            background-color: var(--code-bg);
        }

        .key-value-metadata th,
        .key-value-metadata td {
            border: 1px solid var(--border-color);
            padding: 0.5rem;
            text-align: left;
            overflow-x: auto;
            white-space: nowrap;
        }

        .columns {
            margin: 0;
            padding: 0;
            list-style: none;
        }

        .columns__item {
            margin: 0.4rem 0;
            padding: 0.6rem 0.8rem;
            border: 1px solid var(--column-bg);
            border-radius: 0.5rem;
            background-color: var(--column-bg);
        }

        .columns__props {
            margin: 0;
            padding: 0;
            padding-left: 1rem;
            list-style: none;
            border-left: 1px solid var(--border-color);
        }

        .columns__props.is-open {
            margin-top: 0.6rem;
        }

        .columns__props ul {
            margin: 0;
            padding: 0;
            padding-left: 1rem;
            list-style: none;
        }

        .columns__props li {
            margin: 0.4rem 0;
        }

        .row-group {
            margin: 0;
            padding: 0;
            list-style: none;
        }

        .row-group li {
            margin: 0.4rem 0;
        }

        .row-group__props {
            margin: 0;
            padding: 0;
            padding-left: 1rem;
            list-style: none;
            border-left: 1px solid var(--border-color);
        }

        .row-group__props.is-open {
            margin: 0.6rem 0;
        }

        .row-group__columns {
            margin: 0;
            padding: 0;
            list-style: none;
        }

        .row-group__columns ul {
            margin: 0;
            padding: 0;
            padding-left: 1rem;
            list-style: none;
        }

        .row-group__columns ul.is-open {
            margin-top: 0.6rem;
        }

        .row-group__columns__item {
            padding: 0.6rem 0.8rem;
            border: 1px solid var(--column-bg);
            border-radius: 0.5rem;
            background-color: var(--column-bg);
        }

        .segments {
            margin: 0;
            padding: 0;
            list-style: none;
        }

        .segments .segments {
            margin-left: 1rem;
            margin-right: -1px;
        }

        .segment {
            margin: 0.3rem 0;
            display: flex;
            flex-direction: column;
            border-radius: 0.5rem;
            background-color: var(--segment-color);
            border: 1px solid var(--segment-border-color);
        }

        .segment__top {
            padding: 0.5rem 0.8rem;
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            gap: 0.4rem;
        }

        .segment__right {
            text-align: right;
            font-size: 0.75rem;
            opacity: 0.75;
            white-space: nowrap;
        }

        .segment__name {
            font-family: monospace;
        }

        .segment__value {
            margin-top: 0.4rem;
            font-size: 0.9rem;
        }

        .segment__value--column-chunk-pages {
            opacity: 0.8;
        }

        .segment--magic {
            background-color: var(--segment-color-magic);
            border: none;
        }

        .segment--value {
            background-color: var(--segment-color-value);
            border: none;
        }

        .segment--column-chunk-pages {
            background-color: var(--segment-color-column-chunk-pages);
            border: none;
        }

        .segment--page {
            background-color: var(--segment-color-page);
            border: none;
        }

        .segment--group {
            background-color: var(--segment-color-group);
            border: none;
        }

        .toggle-bytes {
            cursor: pointer;
        }

        .toggle-all {
            font-size: 0.8rem;
            opacity: 0.6;
            text-align: right;
        }

        .toggle-header {
            cursor: pointer;
        }

        .toggle-indicator {
            margin-right: 0.25rem;
            display: inline-block;
            transition: transform 0.3s ease;
        }

        .toggle-content {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: max-height 0.2s ease, opacity 0.2s ease, padding 0.2s ease;
            overflow-x: auto;
        }

        .toggle-content.is-open {
            max-height: 999999px;
            opacity: 1;
        }

        .toggle-expand-all,
        .toggle-collapse-all {
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1 class="title">{{ filename }}</h1>
    <div class="toggle-all">
        <span class="toggle-expand-all">Expand all</span> / <span class="toggle-collapse-all">Collapse all</span>
    </div>
    <section class="section section--summary">
        <div class="section__header toggle-header">
            <span class="toggle-indicator">+</span>
            <h2 class="section__title">Summary</h2>
        </div>
        <div class="section__content toggle-content is-open">
            <ul class="summary">
                <li class="summary__item">
                    <span class="summary__key">File size</span>
                    <span class="summary__value toggle-bytes" title="{{ format_bytes(summary.file_size) }}">{{ "{:,}".format(summary.file_size) }} bytes</span>
                </li>
                <li class="summary__item">
                    <span class="summary__key">Footer size</span>
                    <span class="summary__value toggle-bytes" title="{{ format_bytes(summary.footer_size) }}">{{ "{:,}".format(summary.footer_size) }} bytes</span>
                </li>
                <li class="summary__item">
                    <span class="summary__key">Total page header size</span>
                    <span class="summary__value toggle-bytes" title="{{ format_bytes(summary.page_header_size) }}">{{ "{:,}".format(summary.page_header_size) }} bytes</span>
                </li>
                <li class="summary__item">
                    <span class="summary__key">Total compressed page data size</span>
                    <span class="summary__value toggle-bytes" title="{{ format_bytes(summary.compressed_page_data_size) }}">{{ "{:,}".format(summary.compressed_page_data_size) }} bytes</span>
                </li>
                <li class="summary__item">
                    <span class="summary__key">Total uncompressed page data size</span>
                    <span class="summary__value toggle-bytes" title="{{ format_bytes(summary.uncompressed_page_data_size) }}">{{ "{:,}".format(summary.uncompressed_page_data_size) }} bytes</span>
                </li>
                <li class="summary__item">
                    <span class="summary__key">Compression ratio</span>
                    {% if summary.compressed_page_data_size > 0 %}
                        <span class="summary__value">{{ "%.2f" | format(summary.uncompressed_page_data_size / summary.compressed_page_data_size) }}x</span>
                    {% else %}
                        <span class="summary__value">N/A</span>
                    {% endif %}
                </li>
                <li class="summary__item">
                    <span class="summary__key">Total column index size</span>
                    <span class="summary__value toggle-bytes" title="{{ format_bytes(summary.column_index_size) }}">{{ "{:,}".format(summary.column_index_size) }} bytes</span>
                </li>
                <li class="summary__item">
                    <span class="summary__key">Total offset index size</span>
                    <span class="summary__value toggle-bytes" title="{{ format_bytes(summary.offset_index_size) }}">{{ "{:,}".format(summary.offset_index_size) }} bytes</span>
                </li>
                <li class="summary__item">
                    <span class="summary__key">Total bloom filter size</span>
                    <span class="summary__value toggle-bytes" title="{{ format_bytes(summary.bloom_filter_size) }}">{{ "{:,}".format(summary.bloom_filter_size) }} bytes</span>
                </li>
                <li class="summary__item">
                    <span class="summary__key">Rows</span>
                    <span class="summary__value">{{ "{:,}".format(summary.num_rows) }}</span>
                </li>
                <li class="summary__item">
                    <span class="summary__key">Columns</span>
                    <span class="summary__value">{{ "{:,}".format(summary.num_columns) }}</span>
                </li>
                <li class="summary__item">
                    <span class="summary__key">Row groups</span>
                    <span class="summary__value">{{ "{:,}".format(summary.num_row_groups) }}</span>
                </li>
                <li class="summary__item">
                    <span class="summary__key">Pages</span>
                    <span class="summary__value">{{ "{:,}".format(summary.num_pages) }}</span>
                </li>
                <li class="summary__item">
                    <span class="summary__key">Dictionary pages</span>
                    <span class="summary__value">{{ "{:,}".format(summary.num_dict_pages) }}</span>
                </li>
                <li class="summary__item">
                    <span class="summary__key">Data pages (V1)</span>
                    <span class="summary__value">{{ "{:,}".format(summary.num_v1_data_pages) }}</span>
                </li>
                <li class="summary__item">
                    <span class="summary__key">Data pages (V2)</span>
                    <span class="summary__value">{{ "{:,}".format(summary.num_v2_data_pages) }}</span>
                </li>
                <li class="summary__item">
                    <span class="summary__key">Encoding(s)</span>
                    <span class="summary__value">
                        {% for encoding in encodings %}
                            <code class="enum">{{ encoding }}</code>{% if not loop.last %}, {% endif %}
                        {% endfor %}
                    </span>
                </li>
                <li class="summary__item">
                    <span class="summary__key">Compression codec(s)</span>
                    <span class="summary__value">
                        {% for codec in codecs %}
                            <code class="enum">{{ codec }}</code>{% if not loop.last %}, {% endif %}
                        {% endfor %}
                    </span>
                </li>
                <li class="summary__item">
                    <span class="summary__key">Version</span>
                    <span class="summary__value">{{ footer.version }}</span>
                </li>
                <li class="summary__item">
                    <span class="summary__key">Created by</span>
                    <span class="summary__value">{{ footer.created_by }}</span>
                </li>
            </ul>
        </div>
    </section>
    <section class="section section--schema">
        <div class="section__header toggle-header">
            <span class="toggle-indicator">+</span>
            <h2 class="section__title">Schema</h2>
        </div>
        <div class="section__content toggle-content">
            <div>
                The schema has {{ footer["schema"] | length }} <code>SchemaElement</code> {{ "object" if footer["schema"] | length == 1 else "objects" }}.
            </div>
            <ul class="schema">
                {% for item in schema_tree recursive %}
                    <li class="schema__item">
                        <div class="schema__name">
                            {% if item.repetition_type %}
                                <span class="schema__prop schema__prop--repetition-type"><code class="enum">{{ item.repetition_type }}</code></span>
                            {% endif %}
                            <span class="schema__prop schema__prop--name"><code class="column-name">{{ item.name }}</code></span>
                            {% if item.field_id %}
                                <div class="schema__prop schema__prop--field-id">(Field ID: {{ item.field_id }})</div>
                            {% endif %}
                            {% if item.type %}
                                <code class="data-type">
                                    {%- if item.logical_type -%}
                                        <span class="schema__prop schema__prop--logical-type">{{ format_logical_type(item.logical_type) }}</span>
                                        /
                                        <span class="schema__prop schema__prop--type">{{ item.type }}</span>
                                    {%- elif item.converted_type -%}
                                        <span class="schema__prop schema__prop--converted-type">{{ item.converted_type }}</span>
                                        {%- if item.precision or item.scale -%}
                                            (<span class="schema__prop schema__prop--precision" title="Precision">{{ item.precision }}</span>,
                                            <span class="schema__prop schema__prop--scale" title="Scale">{{ item.scale }}</span>)
                                        {%- endif -%}
                                    {%- else -%}
                                        <span class="schema__prop schema__prop--type">{{ item.type }}</span>
                                    {%- endif -%}
                                    {%- if item.type_length -%}
                                        (<span class="schema__prop schema__prop--type-length" title="Type length">{{ item.type_length }}</span>)
                                    {% endif %}
                                </code>
                            {% endif %}
                            {% if item.num_children and item.num_children > 1 %}
                                <span class="schema__prop schema__prop--num-children">({{ item.num_children }} children)</span>
                            {% endif %}
                        </div>
                        <div class="schema__props">
                            <div class="schema__prop schema__prop--children">
                                {% if item.children %}
                                    <ul class="schema">
                                        {{ loop(item.children) }}
                                    </ul>
                                {% endif %}
                            </div>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        </div>
    </section>
    <section class="section section--key-value-metadata">
        <div class="section__header toggle-header">
            <span class="toggle-indicator">+</span>
            <h2 class="section__title">Key-value metadata</h2>
        </div>
        <div class="section__content toggle-content">
            <div>
                The footer has {{ footer.key_value_metadata | length }} key-value {{ "pair" if footer.key_value_metadata | length == 1 else "pairs" }}.
            </div>
            {% if footer.key_value_metadata %}
                <table class="key-value-metadata">
                    <thead>
                        <tr>
                            <th class="key-value-metadata--key">Key</th>
                            <th class="key-value-metadata--value">Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in footer.key_value_metadata %}
                            <tr>
                                <td class="key-value-metadata--key">{{ item.key }}</td>
                                <td class="key-value-metadata--value">{{ item.value }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% endif %}
        </div>
    </section>
    <section class="section section--rowgroups">
        <div class="section__header toggle-header">
            <span class="toggle-indicator">+</span>
            <h2 class="section__title">Row groups</h2>
        </div>
        <div class="section__content toggle-content">
            <ul class="row-group">
                <li class="toggle-all">
                    <span class="toggle-expand-all">Expand all</span> / <span class="toggle-collapse-all">Collapse all</span>
                </li>
                {% for item in footer.row_groups %}
                    <li class="row-group__item">
                        <div class="toggle-header">
                            <span class="toggle-indicator">+</span> Row group {{ loop.index0 }}
                        </div>
                        <ul class="row-group__props toggle-content">
                            {% if item.file_offset is defined %}
                                <li class="row-group__prop--file-offset">File offset: {{ item.file_offset }}</li>
                            {% endif %}
                            <li class="row-group__prop--num-rows">Rows: {{ "{:,}".format(item.num_rows) }}</li>
                            {% if item.total_compressed_size is defined %}
                                <li class="row-group__prop--total-compressed-size">Total compressed size: {{ "{:,}".format(item.total_compressed_size) }} bytes</li>
                            {% endif %}
                            <li class="row-group__prop--total-byte-size">Total byte size: {{ "{:,}".format(item.total_byte_size) }} bytes</li>
                            <li class="row-group__prop--columns">
                                <ul class="row-group__columns">
                                    <li class="toggle-all">
                                        <span class="toggle-expand-all">Expand all</span> / <span class="toggle-collapse-all">Collapse all</span>
                                    </li>
                                    {% for column in item.columns %}
                                        <li class="row-group__columns__item">
                                            <div class="toggle-header">
                                                <span class="toggle-indicator">+</span>
                                                Column {{ loop.index0 }}: <code class="column-name">{{ column.meta_data.path_in_schema | join(".") }}</code>
                                            </div>
                                            <ul class="row-group__columns__props toggle-content">
                                                <li class="row-group__columns__prop--type">Type: <code class="enum">{{ column.meta_data.type }}</code></li>
                                                {% if column.meta_data.dictionary_page_offset is defined %}
                                                    <li class="row-group__columns__prop--dictionary-page-offset">Dictionary page offset: {{ "{:,}".format(column.meta_data.dictionary_page_offset) }}</li>
                                                {% endif %}
                                                <li class="row-group__columns__prop--data-page-offset">Data page offset: {{ "{:,}".format(column.meta_data.data_page_offset) }}</li>
                                                {% if column.column_index_offset is defined %}
                                                    <li class="row-group__columns__prop--column-index-offset">Column index offset: {{ "{:,}".format(column.column_index_offset) }}</li>
                                                {% endif %}
                                                {% if column.column_index_length is defined %}
                                                    <li class="row-group__columns__prop--column-index-length">Column index length: {{ "{:,}".format(column.column_index_length) }}</li>
                                                {% endif %}
                                                {% if column.offset_index_offset is defined %}
                                                    <li class="row-group__columns__prop--offset-index-offset">Offset index offset: {{ "{:,}".format(column.offset_index_offset) }}</li>
                                                {% endif %}
                                                {% if column.offset_index_length is defined %}
                                                    <li class="row-group__columns__prop--offset-index-length">Offset index length: {{ "{:,}".format(column.offset_index_length) }}</li>
                                                {% endif %}
                                                {% if column.meta_data.bloom_filter_offset is defined %}
                                                    <li class="row-group__columns__prop--bloom-filter-offset">Bloom filter offset: {{ "{:,}".format(column.meta_data.bloom_filter_offset) }}</li>
                                                {% endif %}
                                                {% if column.meta_data.bloom_filter_length is defined %}
                                                    <li class="row-group__columns__prop--bloom-filter-length">Bloom filter length: {{ "{:,}".format(column.meta_data.bloom_filter_length) }} bytes</li>
                                                {% endif %}
                                                <li class="row-group__columns__prop--num-values">Values: {{ "{:,}".format(column.meta_data.num_values) }}</li>
                                                <li class="row-group__columns__prop--total-compressed-size">Total compressed size: {{ "{:,}".format(column.meta_data.total_compressed_size) }} bytes</li>
                                                <li class="row-group__columns__prop--total-uncompressed-size">Total uncompressed size: {{ "{:,}".format(column.meta_data.total_uncompressed_size) }} bytes</li>
                                                {% if column.meta_data.statistics is defined %}
                                                    <li class="row-group__columns__prop--statistics">
                                                        Statistics:
                                                        <ul>
                                                            {% if column.meta_data.statistics.null_count is defined %}
                                                                <li>Null count: {{ "{:,}".format(column.meta_data.statistics.null_count) }}</li>
                                                            {% endif %}
                                                            {% if column.meta_data.statistics.distinct_count is defined %}
                                                                <li>Distinct count: {{ "{:,}".format(column.meta_data.statistics.distinct_count) }}</li>
                                                            {% endif %}
                                                            {% if column.meta_data.statistics.min_value is defined %}
                                                                <li>Min value: <code class="value">{{ format_stats_value(column.meta_data.statistics.min_value, column.meta_data.type, logical_type_mapping[column.meta_data.path_in_schema | tuple]) }}</code></li>
                                                            {% endif %}
                                                            {% if column.meta_data.statistics.max_value is defined %}
                                                                <li>Max value: <code class="value">{{ format_stats_value(column.meta_data.statistics.max_value, column.meta_data.type, logical_type_mapping[column.meta_data.path_in_schema | tuple]) }}</code></li>
                                                            {% endif %}
                                                            {% if column.meta_data.statistics.is_min_value_exact is defined %}
                                                                <li>Is min value exact: {{ column.meta_data.statistics.is_min_value_exact }}</li>
                                                            {% endif %}
                                                            {% if column.meta_data.statistics.is_max_value_exact is defined %}
                                                                <li>Is max value exact: {{ column.meta_data.statistics.is_max_value_exact }}</li>
                                                            {% endif %}
                                                        </ul>
                                                    </li>
                                                {% endif %}
                                                {% if column.meta_data.size_statistics is defined %}
                                                    <li class="row-group__columns__prop--size-statistics">
                                                        Size statistics:
                                                        <ul>
                                                            {% if column.meta_data.size_statistics.unencoded_byte_array_data_bytes is defined %}
                                                                <li>Unencoded byte array data size: {{ "{:,}".format(column.meta_data.size_statistics.unencoded_byte_array_data_bytes) }} bytes</li>
                                                            {% endif %}
                                                            {% if column.meta_data.size_statistics.repetition_level_histogram is defined and column.meta_data.size_statistics.repetition_level_histogram | length > 0 %}
                                                                <li>Repetition level histogram:
                                                                    <ul>
                                                                        {% for count in column.meta_data.size_statistics.repetition_level_histogram %}
                                                                            <li>Level {{ loop.index0 }}: {{ "{:,}".format(count) }}</li>
                                                                        {% endfor %}
                                                                    </ul>
                                                                </li>
                                                            {% endif %}
                                                            {% if column.meta_data.size_statistics.definition_level_histogram is defined and column.meta_data.size_statistics.definition_level_histogram | length > 0 %}
                                                                <li>Definition level histogram:
                                                                    <ul>
                                                                        {% for count in column.meta_data.size_statistics.definition_level_histogram %}
                                                                            <li>Level {{ loop.index0 }}: {{ "{:,}".format(count) }}</li>
                                                                        {% endfor %}
                                                                    </ul>
                                                                </li>
                                                            {% endif %}
                                                        </ul>
                                                    </li>
                                                {% endif %}
                                                <li class="row-group__columns__prop--encodings">
                                                    Encodings:
                                                    {% for encoding in column.meta_data.encodings %}
                                                        <code class="enum">{{ encoding }}</code>{% if not loop.last %}, {% endif %}
                                                    {% endfor %}
                                                </li>
                                                {% if column.meta_data.encoding_stats is defined %}
                                                    <li class="row-group__columns__prop--encoding-stats">
                                                        Encoding stats:
                                                        <ul>
                                                            {% for item in column.meta_data.encoding_stats %}
                                                                <li>
                                                                    <code class="enum">{{ item.page_type }}</code>
                                                                    /
                                                                    <code class="enum">{{ item.encoding }}</code>: {{ "{:,}".format(item.count) }}
                                                                </li>
                                                            {% endfor %}
                                                        </ul>
                                                    </li>
                                                {% endif %}
                                                <li class="row-group__columns__prop--codec">Compression codec: <code class="enum">{{ column.meta_data.codec }}</code></li>
                                                {% if column.meta_data.key_value_metadata is defined %}
                                                    <li class="row-group__columns__prop--key-value-metadata">
                                                        Key-value metadata:
                                                        <ul>
                                                            {% for kv in column.meta_data.key_value_metadata %}
                                                                <li>
                                                                    <code class="value">{{ kv.key }}</code>:
                                                                    {% if kv.value is defined %}
                                                                        <code class="value">{{ kv.value }}</code>
                                                                    {% else %}
                                                                        no value
                                                                    {% endif %}
                                                                </li>
                                                            {% endfor %}
                                                        </ul>
                                                    </li>
                                                {% endif %}
                                            </ul>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </li>
                        </ul>
                    </li>
                {% endfor %}
            </ul>
        </div>
    </section>
    <section class="section section--columns">
        <div class="section__header toggle-header">
            <span class="toggle-indicator">+</span>
            <h2 class="section__title">Columns</h2>
        </div>
        <div class="section__content toggle-content">
            <div>
                Aggregated column statistics across {{ footer.row_groups | length }} row {{ "group" if footer.row_groups | length == 1 else "groups" }}.
            </div>
            <ul class="columns">
                <li class="toggle-all">
                    <span class="toggle-expand-all">Expand all</span> / <span class="toggle-collapse-all">Collapse all</span>
                </li>
                {% for column in columns %}
                    <li class="columns__item">
                        <div class="toggle-header">
                            <span class="toggle-indicator">+</span>
                            Column {{ loop.index0 }}: <code class="column-name">{{ column.path_in_schema | join(".") }}</code>
                        </div>
                        <ul class="columns__props toggle-content">
                            <li>Type: <code class="enum">{{ column.type }}</code></li>
                            <li>Values: {{ "{:,}".format(column.num_values) }}</li>
                            <li>Total compressed size: {{ "{:,}".format(column.total_compressed_size) }} bytes</li>
                            <li>Total uncompressed size: {{ "{:,}".format(column.total_uncompressed_size) }} bytes</li>
                            {% if column.statistics is defined %}
                                <li>Statistics:
                                    <ul>
                                        {% if column.statistics.null_count is defined %}
                                            <li>Null count: {{ "{:,}".format(column.statistics.null_count) }}</li>
                                        {% endif %}
                                        {% if column.statistics.distinct_counts is defined %}
                                            <li>Distinct counts:
                                                <ul>
                                                    {% for distinct_count in column.statistics.distinct_counts %}
                                                        <li>{{ "{:,}".format(distinct_count) }}</li>
                                                    {% endfor %}
                                                </ul>
                                            </li>
                                        {% endif %}
                                        {% if column.statistics.min_value is defined %}
                                            <li>Min value: <code class="value">{{ format_stats_value(column.statistics.min_value, column.type, logical_type_mapping[column.path_in_schema]) }}</code></li>
                                        {% endif %}
                                        {% if column.statistics.max_value is defined %}
                                            <li>Max value: <code class="value">{{ format_stats_value(column.statistics.max_value, column.type, logical_type_mapping[column.path_in_schema]) }}</code></li>
                                        {% endif %}
                                        {% if column.statistics.is_min_value_exact is defined %}
                                            <li>Is min value exact: {{ column.statistics.is_min_value_exact }}</li>
                                        {% endif %}
                                        {% if column.statistics.is_max_value_exact is defined %}
                                            <li>Is max value exact: {{ column.statistics.is_max_value_exact }}</li>
                                        {% endif %}
                                    </ul>
                                </li>
                            {% endif %}
                            <li>
                                Encodings:
                                {% for encoding in column.encodings %}
                                    <code class="enum">{{ encoding }}</code>{% if not loop.last %}, {% endif %}
                                {% endfor %}
                            </li>
                            <li>Encoding stats:
                                <ul>
                                    {% for item in column.encoding_stats.values() %}
                                        <li>
                                            <code class="enum">{{ item.page_type }}</code>
                                            /
                                            <code class="enum">{{ item.encoding }}</code>: {{ "{:,}".format(item.count) }}
                                        </li>
                                    {% endfor %}
                                </ul>
                            </li>
                            <li>
                                Compression codec(s):
                                {% for codec in column.codecs %}
                                    <code class="enum">{{ codec }}</code>{% if not loop.last %}, {% endif %}
                                {% endfor %}
                            </li>
                        </ul>
                    </li>
                {% endfor %}
            </ul>
        </div>
    </section>
    <section class="section section--segments">
        <div class="section__header toggle-header">
            <span class="toggle-indicator">+</span>
            <h2 class="section__title">Segments</h2>
        </div>
        <div class="section__content toggle-content">
            <ul class="segments">
                {% for segment in grouped_segments recursive %}
                    <li class="segment {{ segment_class_mapping.get(segment.name, "") }} {{ "segment--value" if not is_nested_segment(segment) and segment_class_mapping.get(segment.name, "") == "" }}">
                        <div class="segment__top {{ "toggle-header" if is_nested_segment(segment) }}">
                            <div class="segment__left">
                                <div class="segment__header">
                                    {% if is_nested_segment(segment) %}
                                        <span class="toggle-indicator">+</span>
                                    {% endif %}
                                    <span class="segment__name">{{ segment.name }}</span>
                                </div>
                                <div class="segment__value {{ "segment__value--column-chunk-pages" if segment.name == ":column_chunk_pages" }}">
                                    {% if segment.name == ":column_chunk_pages" %}
                                        {{ segment.num_pages }} {{ "pages" if segment.num_pages != 1 else "page" }}
                                        for
                                        row group {{ segment.row_group_index }} column {{ segment.column_index }}
                                    {% endif %}
                                    {% if not is_nested_segment(segment) and segment.value is not none %}
                                        <code class="value">{{ segment.value }}</code>
                                    {% endif %}
                                    {% if segment.metadata is defined %}
                                        {% if segment.metadata.enum_name is defined %}
                                            (<span class="segment__meta segment__meta--enum-name">
                                                {%- if segment.metadata.enum_name is sequence and segment.metadata.enum_name is not string -%}
                                                    {%- for name in segment.metadata.enum_name -%}
                                                        <code class="enum">{{ name }}</code>{%- if not loop.last -%}, {% endif -%}
                                                    {%- endfor -%}
                                                {%- else -%}
                                                    <code class="enum">{{ segment.metadata.enum_name }}</code>
                                                {%- endif -%}
                                            </span>)
                                        {% endif %}
                                        {% if segment.metadata.type is defined %}
                                            <span class="segment__meta segment__meta--type">
                                                {% if not is_nested_segment(segment) and segment.value is not none %}
                                                    of type
                                                {% endif %}
                                                <code class="enum">{{ segment.metadata.type }}</code>
                                            </span>
                                        {% endif %}
                                        {% if segment.metadata.type_class is defined %}
                                            (<span class="segment__meta segment__meta--type-class"><code class="enum">{{ segment.metadata.type_class }}</code></span>)
                                        {% endif %}
                                        {% if segment.metadata.enum_type is defined %}
                                            (<span class="segment__meta segment__meta--enum-type"><code class="enum">{{ segment.metadata.enum_type }}</code></span>)
                                        {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                            <div class="segment__right">
                                <div class="segment__range">bytes {{ segment.offset }}&ndash;{{ segment.offset + segment.length - 1 }}</div>
                                <div class="segment__length">{{ segment.length }} bytes</div>
                            </div>
                        </div>
                        {% if is_nested_segment(segment) %}
                            <div class="segment__bottom toggle-content">
                                <ul class="segments">
                                    {{ loop(segment.value) }}
                                </ul>
                            </div>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        </div>
    </section>
    <section class="section section--raw-footer">
        <div class="section__header toggle-header">
            <span class="toggle-indicator">+</span>
            <h2 class="section__title">Raw footer</h2>
        </div>
        <div class="section__content toggle-content">
            <textarea readonly>{{ to_nice_json(footer) }}</textarea>
        </div>
    </section>
    <script>
        const byteToggles = Array.from(document.querySelectorAll('.toggle-bytes'));

        const swapByteDisplays = () => {
            byteToggles.forEach(el => {
                const current = el.textContent;
                const alt = el.getAttribute('title');
                if (alt !== null) {
                    el.textContent = alt;
                    el.setAttribute('title', current);
                }
            });
        };

        byteToggles.forEach(el => {
            el.addEventListener('click', swapByteDisplays);
        });

        document.querySelectorAll('.toggle-header').forEach(header => {
            const toggle = header.querySelector('.toggle-indicator');
            const content = header.nextElementSibling;

            const syncState = () => {
                const isOpen = content.classList.contains('is-open');
                toggle.textContent = isOpen ? '−' : '+';
                toggle.classList.toggle('is-open', isOpen);
            };

            syncState();

            header.addEventListener('click', () => {
                content.classList.toggle('is-open');
                syncState();
            });
        });

        document.querySelectorAll('.toggle-all').forEach(toggleAll => {
            const toggleExpand = toggleAll.querySelector(':scope > .toggle-expand-all');
            const toggleCollapse = toggleAll.querySelector(':scope > .toggle-collapse-all');
            const indicators = toggleAll.parentElement.querySelectorAll(':scope > * > .toggle-header .toggle-indicator');
            const contents = toggleAll.parentElement.querySelectorAll(':scope > * > .toggle-content');

            toggleExpand.addEventListener('click', () => {
                indicators.forEach(indicator => {
                    indicator.textContent = '−';
                    indicator.classList.add('is-open');
                });
                contents.forEach(content => content.classList.add('is-open'));
            });

            toggleCollapse.addEventListener('click', () => {
                indicators.forEach(indicator => {
                    indicator.textContent = '+';
                    indicator.classList.remove('is-open');
                });
                contents.forEach(content => content.classList.remove('is-open'));
            });
        });
    </script>
</body>
</html>